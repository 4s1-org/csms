stages:
  - validation

validate-all:
  stage: validation
  image: registry.gitlab.com/yellowgarbagegroup/docker-images/node-with-pnpm:14-alpine
  script:
    - pnpm install -r

    - cd common-lib
    - pnpm run lint
    - pnpm run build
    - pnpm run test
    - cd ..

    - cd ocpp-lib
    - pnpm run lint
    - pnpm run build
    - pnpm run test
    - cd ..

    - cd csms-lib
    - pnpm run lint
    - pnpm run build
    - pnpm run test
    - cd ..

    - cd csms
    - pnpm run lint
    - pnpm run build
    - pnpm run test
    - mkdir -p ../data && cp ../utils/certs/certificate.* ../data/
    - pnpm run test:e2e
    - cd ..

    - cd csms-ui
    - pnpm run lint
    - pnpm run build
    - pnpm run test
    - cd ..

    - cd css-lib
    - pnpm run lint
    - pnpm run build
    - pnpm run test
    - cd ..

    - cd css-ui
    - pnpm run lint
    - pnpm run build
    - pnpm run test
    - cd ..

    - cd css-cli
    - pnpm run lint
    - pnpm run build
    - pnpm run test
    - cd ..
